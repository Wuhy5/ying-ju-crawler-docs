# 音频数据源规则示例
# 
# 本示例演示如何为音乐平台创建爬虫规则，包含：
# - 歌曲搜索
# - 列表页解析（歌曲列表）
# - 详情页解析（歌曲元数据）
# - JSON API 响应解析

[meta]
name = "网易音乐"
author = "示例作者"
version = "1.0.0"
description = "网易音乐数据采集规则（示例）"
domain = "music.163.com"
media_type = "audio"
language = "zh-CN"
region = "CN"
tags = ["音乐", "歌曲", "歌手"]

[http]
user_agent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
timeout = 30
rate_limit = 10

[http.headers]
Referer = "https://music.163.com/"

# 搜索歌曲
[search]
entry_url_template = "https://api.{domain}/search/songs?keyword={keyword}&page={page}"
method = "GET"
response_type = "json"

# 歌单发现
[discover]
entry_url_template = "https://api.{domain}/playlist/{cate_id}?page={page}"
method = "GET"
response_type = "json"

[[discover.categories]]
name = "华语"
id = "huayu"

[[discover.categories]]
name = "欧美"
id = "western"

[[discover.categories]]
name = "日韩"
id = "japan_korea"

[parse]
  # 列表页解析：从搜索结果提取歌曲列表
  [parse.list]
    # JSON API 响应解析
    item_selector = { type = "jsonpath", query = "$.result.songs[*]" }
    
    [parse.list.fields]
      # 歌曲标题
      title = [
        { type = "jsonpath", query = "$.name" }
      ]
      
      # 歌曲详情页链接
      url = [
        { type = "jsonpath", query = "$.id" },
        { type = "string", operation = "format", template = "https://{domain}/song/{input}" }
      ]
      
      # 歌曲封面
      cover = [
        { type = "jsonpath", query = "$.album.picUrl" }
      ]
      
      # 歌曲描述/简介
      description = [
        { type = "jsonpath", query = "$.album.description" }
      ]
      
      # 艺术家（音频特定字段）
      artist = [
        { type = "jsonpath", query = "$.artists[0].name" }
      ]
      
      # 专辑（音频特定字段）
      album = [
        { type = "jsonpath", query = "$.album.name" }
      ]
      
      # 时长（秒）（音频特定字段）
      duration = [
        { type = "jsonpath", query = "$.duration" },
        # 转换为整数
        { type = "string", operation = "parseInt" }
      ]
      
      # 发布日期
      publish_date = [
        { type = "jsonpath", query = "$.album.publishTime" }
      ]
  
  # 详情页解析
  [parse.detail]
    [parse.detail.fields]
      title = [
        { type = "jsonpath", query = "$.song.name" }
      ]
      
      artist = [
        { type = "jsonpath", query = "$.song.artists[0].name" }
      ]
      
      album = [
        { type = "jsonpath", query = "$.song.album.name" }
      ]
      
      cover = [
        { type = "jsonpath", query = "$.song.album.picUrl" }
      ]
      
      description = [
        { type = "jsonpath", query = "$.song.description" }
      ]
      
      duration = [
        { type = "jsonpath", query = "$.song.duration" }
      ]
      
      publish_date = [
        { type = "jsonpath", query = "$.song.album.publishTime" }
      ]
      
      # 音频质量选项
      audio_quality = [
        { type = "jsonpath", query = "$.privileges[0].chargeType" }
      ]
