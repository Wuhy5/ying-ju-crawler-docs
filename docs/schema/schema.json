{
  "$comment": "Schema version: 1.0.0",
  "$defs": {
    "ChapterListRule": {
      "additionalProperties": false,
      "description": "章节列表提取规则 (ChapterListRule)\n定义如何提取章节列表",
      "properties": {
        "list": {
          "$ref": "#/$defs/FieldRule",
          "description": "章节列表容器的提取流程\n应返回一个包含多个章节元素的数组"
        },
        "title": {
          "$ref": "#/$defs/FieldRule",
          "description": "章节标题的提取规则（相对于单个章节元素）"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "章节 URL 的提取规则（相对于单个章节元素）"
        }
      },
      "required": [
        "list",
        "title",
        "url"
      ],
      "type": "object"
    },
    "ContentFields": {
      "description": "内容页字段规则 (ContentFields)\n用于播放页、阅读页等内容消费页面\n\n使用 Box 包装以减少枚举大小差异",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "视频播放字段",
          "properties": {
            "media_type": {
              "const": "video",
              "type": "string"
            },
            "play_url": {
              "$ref": "#/$defs/FieldRule",
              "description": "播放地址（必需）"
            },
            "quality": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "画质信息（可选）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "视频标题（可选）"
            }
          },
          "required": [
            "media_type",
            "play_url"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "音频播放字段",
          "properties": {
            "artist": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "艺术家（可选）"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面图（可选）"
            },
            "duration": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "时长（可选）"
            },
            "lyrics": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "歌词/文本内容（可选）"
            },
            "media_type": {
              "const": "audio",
              "type": "string"
            },
            "play_url": {
              "$ref": "#/$defs/FieldRule",
              "description": "播放地址（必需）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "音频标题（可选）"
            }
          },
          "required": [
            "media_type",
            "play_url"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "书籍正文字段",
          "properties": {
            "content": {
              "$ref": "#/$defs/FieldRule",
              "description": "正文内容（必需）"
            },
            "media_type": {
              "const": "book",
              "type": "string"
            },
            "next_page_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "下一页 URL（用于分页章节）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节标题（可选，可能需要从正文页重新获取）"
            }
          },
          "required": [
            "media_type",
            "content"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "漫画阅读字段",
          "properties": {
            "images": {
              "$ref": "#/$defs/FieldRule",
              "description": "图片列表（必需）"
            },
            "media_type": {
              "const": "manga",
              "type": "string"
            },
            "next_chapter_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "下一章 URL（可选）"
            },
            "prev_chapter_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "上一章 URL（可选）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节标题（可选）"
            }
          },
          "required": [
            "media_type",
            "images"
          ],
          "type": "object"
        }
      ]
    },
    "ContentFlow": {
      "additionalProperties": false,
      "description": "内容页流程 (ContentFlow)\n用于播放页、阅读页等内容消费页面\n\n例如：\n- 视频：解析真实播放地址\n- 书籍：获取章节正文内容\n- 漫画：获取章节图片列表\n- 音频：获取音频播放地址\n\n# 示例\n\n```toml\n[content]\nurl = \"{{ play_url }}\"\n\n[content.fields]\nmedia_type = \"video\"\nplay_url.steps = [{ css = \"#player\" }, { attr = \"src\" }, { filter = \"absolute_url\" }]\n```",
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/ContentFields",
          "description": "内容字段提取规则"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "内容页 URL 模板\n约定输入变量: {{ play_url }} 或 {{ chapter_url }}"
        }
      },
      "required": [
        "url",
        "fields"
      ],
      "type": "object"
    },
    "CredentialField": {
      "additionalProperties": false,
      "description": "凭证字段定义",
      "properties": {
        "field_type": {
          "$ref": "#/$defs/CredentialFieldType",
          "default": "text",
          "description": "字段类型"
        },
        "help": {
          "description": "帮助说明文本",
          "type": [
            "string",
            "null"
          ]
        },
        "key": {
          "description": "字段标识符（变量名）",
          "type": "string"
        },
        "label": {
          "description": "字段显示名称",
          "type": "string"
        },
        "placeholder": {
          "description": "占位符文本",
          "type": [
            "string",
            "null"
          ]
        },
        "required": {
          "default": true,
          "description": "是否必填（默认 true）",
          "type": "boolean"
        }
      },
      "required": [
        "key",
        "label"
      ],
      "type": "object"
    },
    "CredentialFieldType": {
      "description": "凭证字段类型",
      "oneOf": [
        {
          "const": "text",
          "description": "普通文本（单行）",
          "type": "string"
        },
        {
          "const": "password",
          "description": "密码（隐藏显示）",
          "type": "string"
        },
        {
          "const": "textarea",
          "description": "多行文本（如 Cookie 字符串、Token）",
          "type": "string"
        }
      ]
    },
    "CredentialStorage": {
      "description": "凭证存储方式\n\n定义如何将用户输入的凭证应用到 HTTP 请求中",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "存储为 Cookie\n凭证将作为 Cookie 随请求发送",
          "properties": {
            "domain": {
              "description": "Cookie 的域名（可选，默认为规则的 domain）",
              "type": [
                "string",
                "null"
              ]
            },
            "field_key": {
              "description": "要存储的字段 key（对应 fields 中的 key）\n如果不指定，则使用名为 \"cookie\" 的字段或第一个 textarea 类型字段",
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "const": "cookie",
              "type": "string"
            }
          },
          "required": [
            "type"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "添加到请求头\n凭证将添加到指定的 HTTP Header",
          "properties": {
            "header_name": {
              "description": "HTTP Header 名称\n例如: \"Authorization\", \"X-Token\", \"X-Api-Key\"",
              "type": "string"
            },
            "header_template": {
              "$ref": "#/$defs/Template",
              "description": "Header 值模板\n支持变量插值，如 \"Bearer {{ token }}\" 或直接 \"{{ api_key }}\""
            },
            "type": {
              "const": "header",
              "type": "string"
            }
          },
          "required": [
            "type",
            "header_name",
            "header_template"
          ],
          "type": "object"
        }
      ]
    },
    "DetailFields": {
      "description": "详情页字段规则 (DetailFields)\n根据媒体类型使用不同的字段定义\n\n使用 Box 包装以减少枚举大小差异",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "视频详情字段",
          "properties": {
            "actors": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "演员"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类/类型"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面/海报"
            },
            "director": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "导演"
            },
            "duration": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "时长"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/剧情介绍"
            },
            "language": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "语言"
            },
            "media_type": {
              "const": "video",
              "type": "string"
            },
            "play_lines": {
              "anyOf": [
                {
                  "$ref": "#/$defs/PlayLineListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "播放线路列表提取规则"
            },
            "region": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "地区"
            },
            "score": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "评分"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "片名（必需）"
            },
            "update_info": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新信息/集数状态"
            },
            "year": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "年份"
            }
          },
          "required": [
            "media_type",
            "title"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "音频详情字段",
          "properties": {
            "album": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "专辑名"
            },
            "artist": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "艺术家/作者"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/描述"
            },
            "media_type": {
              "const": "audio",
              "type": "string"
            },
            "play_count": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "播放量"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "标题（必需）"
            },
            "tracks": {
              "anyOf": [
                {
                  "$ref": "#/$defs/TrackListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "音轨列表提取规则"
            },
            "update_time": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新时间"
            }
          },
          "required": [
            "media_type",
            "title"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "书籍详情字段",
          "properties": {
            "author": {
              "$ref": "#/$defs/FieldRule",
              "description": "作者（必需）"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类/类型"
            },
            "chapters": {
              "anyOf": [
                {
                  "$ref": "#/$defs/ChapterListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节列表提取规则"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面图 URL"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/描述"
            },
            "last_chapter": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "最新章节名"
            },
            "media_type": {
              "const": "book",
              "type": "string"
            },
            "status": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "连载状态"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "书名（必需）"
            },
            "toc_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "目录页 URL（如果目录在单独页面）"
            },
            "update_time": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新时间"
            },
            "word_count": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "字数"
            }
          },
          "required": [
            "media_type",
            "title",
            "author"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "漫画详情字段",
          "properties": {
            "author": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "作者"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类"
            },
            "chapters": {
              "anyOf": [
                {
                  "$ref": "#/$defs/ChapterListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节列表提取规则"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/描述"
            },
            "last_chapter": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "最新章节"
            },
            "media_type": {
              "const": "manga",
              "type": "string"
            },
            "status": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "连载状态"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "漫画名（必需）"
            },
            "update_time": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新时间"
            }
          },
          "required": [
            "media_type",
            "title"
          ],
          "type": "object"
        }
      ]
    },
    "DetailFlow": {
      "additionalProperties": false,
      "description": "详情页流程 (DetailFlow)\n处理单个内容项的详细信息\n\n# 示例\n\n```toml\n[detail]\nurl = \"{{ detail_url }}\"\n\n[detail.fields]\nmedia_type = \"video\"\ntitle.steps = [{ css = \".title\" }, { filter = \"trim\" }]\ncover.steps = [{ css = \".poster img\" }, { attr = \"src\" }, { filter = \"absolute_url\" }]\n```",
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/DetailFields",
          "description": "字段提取规则\n根据媒体类型定义不同的字段集合"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "详情页 URL 模板\n约定输入变量: {{ detail_url }}"
        }
      },
      "required": [
        "url",
        "fields"
      ],
      "type": "object"
    },
    "DiscoveryFlow": {
      "additionalProperties": false,
      "description": "发现页流程 (DiscoveryFlow)\n用于列表页、分类页、发现页等场景\n\n# 示例\n\n```toml\n[discovery]\nurl = \"https://example.com/category/{{ category }}?page={{ page }}\"\n\n[discovery.pagination]\npagination_type = \"page_number\"\nstart_page = 1\n\n[discovery.fields.title]\nsteps = [{ css = \".title\" }, { filter = \"trim\" }]\n\n[discovery.fields.url]\nsteps = [{ css = \"a\" }, { attr = \"href\" }]\n```",
      "properties": {
        "categories": {
          "anyOf": [
            {
              "$ref": "#/$defs/OptionList"
            },
            {
              "type": "null"
            }
          ],
          "description": "分类列表（可选）\n静态数组或动态获取配置"
        },
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/ItemFields",
          "description": "将列表项映射为最终数据结构的字段提取规则"
        },
        "filters": {
          "anyOf": [
            {
              "$ref": "#/$defs/FilterList"
            },
            {
              "type": "null"
            }
          ],
          "description": "筛选器组列表（可选）\n静态数组或动态获取配置"
        },
        "list": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "list 列表提取规则"
        },
        "pagination": {
          "anyOf": [
            {
              "$ref": "#/$defs/PaginationConfig"
            },
            {
              "type": "null"
            }
          ],
          "description": "分页配置（可选）"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "数据源 URL 模板\n支持变量: {{ category }}, {{ page }}, 自定义筛选器变量"
        }
      },
      "required": [
        "url",
        "list",
        "fields"
      ],
      "type": "object"
    },
    "DynamicFilterList": {
      "additionalProperties": false,
      "description": "动态筛选器组列表配置",
      "properties": {
        "fields": {
          "$ref": "#/$defs/FilterGroupFields",
          "description": "筛选组字段提取规则"
        },
        "list": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "筛选组列表提取规则"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "数据源 URL"
        }
      },
      "required": [
        "url",
        "list",
        "fields"
      ],
      "type": "object"
    },
    "DynamicOptionList": {
      "additionalProperties": false,
      "description": "动态选项列表配置",
      "properties": {
        "fields": {
          "$ref": "#/$defs/OptionFields",
          "description": "选项字段提取规则"
        },
        "list": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "列表提取规则\n提取出选项列表的数组"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "数据源 URL"
        }
      },
      "required": [
        "url",
        "list",
        "fields"
      ],
      "type": "object"
    },
    "EpisodeListRule": {
      "additionalProperties": false,
      "description": "剧集列表提取规则 (EpisodeListRule)",
      "properties": {
        "list": {
          "$ref": "#/$defs/FieldRule",
          "description": "剧集列表的提取流程"
        },
        "name": {
          "$ref": "#/$defs/FieldRule",
          "description": "剧集名称的提取规则"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "剧集播放页 URL 的提取规则"
        }
      },
      "required": [
        "list",
        "name",
        "url"
      ],
      "type": "object"
    },
    "ExtractStep": {
      "description": "提取步骤 (ExtractStep)\n\n单个原子化操作。步骤类型：\n- **选择步骤**：css, json, regex\n- **过滤步骤**：filter, attr, index\n- **特殊步骤**：const, var, script",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "CSS 选择器（HTML）",
          "properties": {
            "css": {
              "$ref": "#/$defs/SelectorStep"
            }
          },
          "required": [
            "css"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "JSONPath 表达式（JSON）",
          "properties": {
            "json": {
              "$ref": "#/$defs/SelectorStep"
            }
          },
          "required": [
            "json"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "正则表达式（文本）",
          "properties": {
            "regex": {
              "$ref": "#/$defs/RegexStep"
            }
          },
          "required": [
            "regex"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "过滤器管道",
          "properties": {
            "filter": {
              "$ref": "#/$defs/FilterStep"
            }
          },
          "required": [
            "filter"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "属性提取",
          "properties": {
            "attr": {
              "type": "string"
            }
          },
          "required": [
            "attr"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "索引/切片",
          "properties": {
            "index": {
              "$ref": "#/$defs/IndexStep"
            }
          },
          "required": [
            "index"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "常量值",
          "properties": {
            "const": true
          },
          "required": [
            "const"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "上下文变量",
          "properties": {
            "var": {
              "type": "string"
            }
          },
          "required": [
            "var"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "脚本调用",
          "properties": {
            "script": {
              "$ref": "#/$defs/Script"
            }
          },
          "required": [
            "script"
          ],
          "type": "object"
        }
      ]
    },
    "FieldExtractor": {
      "additionalProperties": false,
      "description": "字段提取器 (FieldExtractor)\n\n定义如何从响应数据中提取单个字段的值。\n通过步骤列表定义提取流程。\n\n# 示例\n\n```toml\n# 单步骤\ntitle.steps = [{ css = \".title\" }]\n\n# 多步骤\ncover.steps = [\n    { css = \"img\" },\n    { attr = \"src\" },\n    { filter = \"absolute_url\" }\n]\n\n# 带回退和默认值\nauthor.steps = [{ css = \".author\" }]\nauthor.fallback = [\n    [{ css = \".writer\" }],\n    [{ css = \".creator\" }]\n]\nauthor.default = \"佚名\"\n```",
      "properties": {
        "default": {
          "description": "默认值\n\n所有提取（包括回退）都失败时使用此值"
        },
        "fallback": {
          "description": "回退步骤链\n\n当主步骤提取失败（结果为空或 null）时，按顺序尝试这些备选流程",
          "items": {
            "items": {
              "$ref": "#/$defs/ExtractStep"
            },
            "type": "array"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "nullable": {
          "default": false,
          "description": "是否允许空值",
          "type": "boolean"
        },
        "steps": {
          "description": "提取步骤列表\n\n按顺序执行，前一步骤的输出作为后一步骤的输入",
          "items": {
            "$ref": "#/$defs/ExtractStep"
          },
          "type": "array"
        }
      },
      "required": [
        "steps"
      ],
      "type": "object"
    },
    "FieldRule": {
      "$ref": "#/$defs/FieldExtractor",
      "description": "字段规则 (FieldRule)\n定义单个字段的提取方式\n\n`FieldRule` 是 `FieldExtractor` 的透明包装，提供更语义化的类型名。\n\n# 示例\n\n```toml\n# 单步骤提取\ntitle.steps = [{ css = \".title\" }, { filter = \"trim\" }]\n\n# 带回退和默认值\ncover.steps = [{ css = \".poster img\" }, { attr = \"src\" }, { filter = \"absolute_url\" }]\ncover.fallback = [[{ css = \".thumbnail\" }, { attr = \"src\" }]]\ncover.default = \"/default-cover.jpg\"\n```"
    },
    "FilterConfig": {
      "additionalProperties": false,
      "description": "过滤器配置（结构化形式）",
      "properties": {
        "args": {
          "description": "过滤器参数",
          "items": true,
          "type": [
            "array",
            "null"
          ]
        },
        "name": {
          "description": "过滤器名称",
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "type": "object"
    },
    "FilterGroup": {
      "additionalProperties": false,
      "description": "筛选器组 (FilterGroup)\n代表UI上一组相关的筛选选项，如\"地区\"、\"年份\"。",
      "properties": {
        "key": {
          "description": "此筛选器组在URL模板中对应的键 (`key`)。",
          "type": "string"
        },
        "multiselect": {
          "default": false,
          "description": "是否允许多选。",
          "type": "boolean"
        },
        "name": {
          "description": "筛选器组的显示名称，如 \"按类型\"。",
          "type": "string"
        },
        "options": {
          "description": "此筛选器组下所有可用的选项。",
          "items": {
            "$ref": "#/$defs/FilterOption"
          },
          "type": "array"
        }
      },
      "required": [
        "name",
        "key",
        "options"
      ],
      "type": "object"
    },
    "FilterGroupFields": {
      "additionalProperties": false,
      "description": "筛选组字段定义（用于动态提取）",
      "properties": {
        "key": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "筛选组标识提取规则"
        },
        "multiselect": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldExtractor"
            },
            {
              "type": "null"
            }
          ],
          "description": "是否多选提取规则（可选）"
        },
        "name": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "筛选组名称提取规则"
        },
        "options": {
          "$ref": "#/$defs/NestedOptionList",
          "description": "选项列表配置"
        }
      },
      "required": [
        "key",
        "name",
        "options"
      ],
      "type": "object"
    },
    "FilterList": {
      "anyOf": [
        {
          "description": "静态筛选器组列表",
          "items": {
            "$ref": "#/$defs/FilterGroup"
          },
          "type": "array"
        },
        {
          "$ref": "#/$defs/DynamicFilterList",
          "description": "动态获取配置"
        }
      ],
      "description": "筛选器组列表\n\n支持静态定义或从数据源动态获取\n\n# 示例\n\n## 静态定义\n```toml\n[[filters]]\nkey = \"year\"\nname = \"年份\"\noptions = [\n  { key = \"2024\", name = \"2024年\" },\n  { key = \"2023\", name = \"2023年\" },\n]\n\n[[filters]]\nkey = \"area\"\nname = \"地区\"\noptions = [\n  { key = \"cn\", name = \"中国\" },\n  { key = \"us\", name = \"美国\" },\n]\n```\n\n## 动态获取\n```toml\n[filters]\nurl = \"https://example.com/filters\"\nlist.steps = [{ css = \".filter-group\" }]\n\n[filters.fields]\nkey.steps = [{ attr = \"data-key\" }]\nname.steps = [{ css = \".group-name\" }]\n\n[filters.fields.options]\nlist.steps = [{ css = \".filter-option\" }]\n\n[filters.fields.options.fields]\nkey.steps = [{ attr = \"data-value\" }]\nname.steps = [{ css = \"text()\" }]\n```"
    },
    "FilterOption": {
      "additionalProperties": false,
      "description": "筛选器选项 (FilterOption)\n代表一个具体的筛选选项，如\"电影\"或\"2023年\"。",
      "properties": {
        "name": {
          "description": "选项的显示名称，如 \"美国\"。",
          "type": "string"
        },
        "value": {
          "description": "选项的值，将用于替换URL模板中对应的 `key`。",
          "type": "string"
        }
      },
      "required": [
        "name",
        "value"
      ],
      "type": "object"
    },
    "FilterOptionFields": {
      "additionalProperties": false,
      "description": "筛选选项字段定义",
      "properties": {
        "key": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "选项标识/值提取规则"
        },
        "name": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "选项名称提取规则"
        }
      },
      "required": [
        "key",
        "name"
      ],
      "type": "object"
    },
    "FilterStep": {
      "anyOf": [
        {
          "description": "管道字符串：`\"trim | lower | replace(a, b)\"`",
          "type": "string"
        },
        {
          "description": "过滤器数组（复杂参数场景）",
          "items": {
            "$ref": "#/$defs/FilterConfig"
          },
          "type": "array"
        }
      ],
      "description": "过滤器步骤"
    },
    "HttpConfig": {
      "additionalProperties": false,
      "description": "全局HTTP配置 (HttpConfig)\n定义所有网络请求的默认行为。",
      "properties": {
        "connect_timeout": {
          "description": "连接超时时间（秒）。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "follow_redirects": {
          "description": "是否允许重定向。",
          "type": [
            "boolean",
            "null"
          ]
        },
        "headers": {
          "additionalProperties": {
            "type": "string"
          },
          "description": "全局请求头。",
          "type": [
            "object",
            "null"
          ]
        },
        "max_concurrent": {
          "description": "最大并发请求数。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "max_redirects": {
          "description": "最大重定向次数。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "proxy": {
          "description": "全局代理地址。",
          "type": [
            "string",
            "null"
          ]
        },
        "request_delay": {
          "description": "请求间隔时间（毫秒），用于限流。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "retry_count": {
          "description": "重试次数。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "retry_delay": {
          "description": "重试间隔（毫秒）。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "timeout": {
          "description": "全局请求超时时间（秒）。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "user_agent": {
          "description": "全局 User-Agent。",
          "type": [
            "string",
            "null"
          ]
        },
        "verify_ssl": {
          "description": "是否验证SSL证书。",
          "type": [
            "boolean",
            "null"
          ]
        }
      },
      "type": "object"
    },
    "IndexStep": {
      "anyOf": [
        {
          "description": "单个索引",
          "format": "int32",
          "type": "integer"
        },
        {
          "description": "切片表达式 \"start:end\" 或 \"start:end:step\"",
          "type": "string"
        }
      ],
      "description": "索引/切片步骤"
    },
    "ItemFields": {
      "additionalProperties": false,
      "description": "列表项字段规则 (ItemFields)\n定义列表页中每个项目需要提取的字段\n这些字段将构成 ItemSummary",
      "properties": {
        "author": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "作者/创作者（书籍、漫画、音频常用）"
        },
        "category": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "分类/标签（返回字符串，多个标签用分隔符分开）"
        },
        "cover": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "封面图 URL"
        },
        "extra": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "扩展字段（用于媒体类型特定的额外信息）"
        },
        "latest": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "最新章节/更新信息"
        },
        "score": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "评分"
        },
        "status": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "状态（连载中/已完结等）"
        },
        "summary": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "简介/摘要"
        },
        "title": {
          "$ref": "#/$defs/FieldRule",
          "description": "标题（必需）"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "详情页 URL（必需）"
        }
      },
      "required": [
        "title",
        "url"
      ],
      "type": "object"
    },
    "LoginFlow": {
      "description": "登录流程配置\n\n通过 `type` 字段区分三种完全不同的登录模式：\n- `script`: 脚本交互模式（覆盖 Legado 的 loginUi + loginUrl 场景）\n- `webview`: 网页模式\n- `credential`: 凭证模式（支持 Cookie、Header 等多种认证方式）\n\n# 示例\n\n## 脚本交互模式\n```toml\n[login]\ntype = \"script\"\nui = [\n  { type = \"text\", key = \"username\", label = \"用户名\" },\n  { type = \"password\", key = \"password\", label = \"密码\" },\n  { type = \"image\", key = \"captcha_img\", action = { name = \"refresh_captcha\" } },\n  { type = \"text\", key = \"captcha\", label = \"验证码\" },\n]\ninit_script = { name = \"init_login\" }\nlogin_script = { name = \"do_login\" }\n```\n\n## WebView 模式\n```toml\n[login]\ntype = \"webview\"\nstart_url = \"https://example.com/login\"\ncheck_script = \"return document.querySelector('.user-info') !== null;\"\nfinish_script = { name = \"save_cookies\" }\n```\n\n## Credential 模式（Cookie）\n```toml\n[login]\ntype = \"credential\"\ntip = \"请从浏览器开发者工具中复制 Cookie\"\ndocs_url = \"https://example.com/help/cookie\"\nstorage = [{ type = \"cookie\" }]\n```\n\n## Credential 模式（Header Token）\n```toml\n[login]\ntype = \"credential\"\ntip = \"请输入您的 API Token\"\nfields = [{ key = \"token\", label = \"API Token\", field_type = \"password\" }]\nstorage = [{ type = \"header\", header_name = \"Authorization\", header_template = \"Bearer {{ token }}\" }]\n```",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "脚本交互模式\nApp 渲染原生 UI，脚本处理逻辑（覆盖 Legado 的 loginUi + loginUrl 场景）",
          "properties": {
            "description": {
              "description": "流程的功能描述",
              "type": [
                "string",
                "null"
              ]
            },
            "init_script": {
              "anyOf": [
                {
                  "$ref": "#/$defs/Script"
                },
                {
                  "type": "null"
                }
              ],
              "description": "界面打开时自动执行的脚本\n例如：自动加载图形验证码，或获取初始 Cookie"
            },
            "login_script": {
              "$ref": "#/$defs/Script",
              "description": "用户点击界面底部\"登录/确认\"按钮时执行的主逻辑脚本"
            },
            "type": {
              "const": "script",
              "type": "string"
            },
            "ui": {
              "description": "定义原生界面元素（输入框、按钮、验证码图片）",
              "items": {
                "$ref": "#/$defs/LoginUIElement"
              },
              "type": "array"
            }
          },
          "required": [
            "type",
            "ui",
            "login_script"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "网页模式\n打开浏览器，用户操作网页，脚本检测状态",
          "properties": {
            "allow_redirects": {
              "default": true,
              "description": "是否允许重定向（默认 true）",
              "type": "boolean"
            },
            "check_interval_ms": {
              "description": "检测间隔（毫秒，默认 500）",
              "format": "uint32",
              "minimum": 0,
              "type": [
                "integer",
                "null"
              ]
            },
            "check_script": {
              "description": "周期性执行的检测 JavaScript\n返回 true 代表登录成功\n例如: `return document.querySelector('.user-info') !== null;`",
              "type": [
                "string",
                "null"
              ]
            },
            "description": {
              "description": "流程的功能描述",
              "type": [
                "string",
                "null"
              ]
            },
            "finish_script": {
              "anyOf": [
                {
                  "$ref": "#/$defs/Script"
                },
                {
                  "type": "null"
                }
              ],
              "description": "登录成功后（WebView 关闭前）执行的整理脚本\n用于从 WebView 提取特定 Cookie/LocalStorage 并保存到全局变量"
            },
            "inject_script": {
              "description": "页面加载完成后注入的 JavaScript\n用于处理网页内的 DOM，如点击协议、自动填表等",
              "type": [
                "string",
                "null"
              ]
            },
            "start_url": {
              "$ref": "#/$defs/Template",
              "description": "登录起始页 URL"
            },
            "timeout_seconds": {
              "description": "登录超时时间（秒，默认 300）",
              "format": "uint32",
              "minimum": 0,
              "type": [
                "integer",
                "null"
              ]
            },
            "type": {
              "const": "webview",
              "type": "string"
            },
            "user_agent": {
              "description": "自定义 User-Agent（可选）",
              "type": [
                "string",
                "null"
              ]
            }
          },
          "required": [
            "type",
            "start_url"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "凭证模式\n手动粘贴 Cookie/Token/Header 等认证信息",
          "properties": {
            "description": {
              "description": "流程的功能描述",
              "type": [
                "string",
                "null"
              ]
            },
            "docs_url": {
              "description": "获取教程的链接（可选）",
              "type": [
                "string",
                "null"
              ]
            },
            "fields": {
              "description": "需要用户提供的凭证字段（可选）\n如果不提供，默认显示一个多行文本框用于输入 Cookie",
              "items": {
                "$ref": "#/$defs/CredentialField"
              },
              "type": [
                "array",
                "null"
              ]
            },
            "storage": {
              "description": "凭证存储方式（可选）\n定义如何将用户输入的凭证应用到 HTTP 请求\n如果不提供，默认作为 Cookie 处理",
              "items": {
                "$ref": "#/$defs/CredentialStorage"
              },
              "type": [
                "array",
                "null"
              ]
            },
            "tip": {
              "description": "提示用户如何获取凭证的说明文案",
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "const": "credential",
              "type": "string"
            },
            "validate_script": {
              "anyOf": [
                {
                  "$ref": "#/$defs/Script"
                },
                {
                  "type": "null"
                }
              ],
              "description": "凭证验证脚本（可选，验证用户输入的凭证是否有效）"
            }
          },
          "required": [
            "type"
          ],
          "type": "object"
        }
      ]
    },
    "LoginUIElement": {
      "description": "登录界面 UI 元素定义\n\n仅用于 Script 模式，定义 App 原生渲染的界面元素",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "文本输入框",
          "properties": {
            "key": {
              "description": "字段标识符（变量名，脚本通过此 key 获取用户输入）",
              "type": "string"
            },
            "label": {
              "description": "字段显示名称",
              "type": [
                "string",
                "null"
              ]
            },
            "placeholder": {
              "description": "占位符文本",
              "type": [
                "string",
                "null"
              ]
            },
            "required": {
              "default": true,
              "description": "是否必填（默认 true）",
              "type": "boolean"
            },
            "type": {
              "const": "text",
              "type": "string"
            }
          },
          "required": [
            "type",
            "key"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "密码输入框（隐藏显示）",
          "properties": {
            "key": {
              "description": "字段标识符（变量名，脚本通过此 key 获取用户输入）",
              "type": "string"
            },
            "label": {
              "description": "字段显示名称",
              "type": [
                "string",
                "null"
              ]
            },
            "placeholder": {
              "description": "占位符文本",
              "type": [
                "string",
                "null"
              ]
            },
            "required": {
              "default": true,
              "description": "是否必填（默认 true）",
              "type": "boolean"
            },
            "type": {
              "const": "password",
              "type": "string"
            }
          },
          "required": [
            "type",
            "key"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "功能按钮（如获取短信验证码）",
          "properties": {
            "action": {
              "$ref": "#/$defs/Script",
              "description": "点击按钮触发的脚本逻辑\n例如：获取短信验证码、刷新图形验证码"
            },
            "disabled": {
              "description": "是否禁用（可选，用于条件性禁用按钮）",
              "type": [
                "boolean",
                "null"
              ]
            },
            "label": {
              "description": "按钮显示文本",
              "type": "string"
            },
            "type": {
              "const": "button",
              "type": "string"
            }
          },
          "required": [
            "type",
            "label",
            "action"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "图片显示（如图形验证码）",
          "properties": {
            "action": {
              "anyOf": [
                {
                  "$ref": "#/$defs/Script"
                },
                {
                  "type": "null"
                }
              ],
              "description": "点击图片触发的脚本（通常用于刷新验证码）"
            },
            "key": {
              "description": "绑定变量名\n脚本更新此变量时，图片自动刷新",
              "type": "string"
            },
            "label": {
              "description": "图片显示描述（可选）",
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "const": "image",
              "type": "string"
            }
          },
          "required": [
            "type",
            "key"
          ],
          "type": "object"
        }
      ]
    },
    "MediaType": {
      "description": "用于指定规则适用的媒体内容类型。",
      "oneOf": [
        {
          "const": "video",
          "description": "视频类型，如电影、电视剧等。",
          "type": "string"
        },
        {
          "const": "audio",
          "description": "音频类型，如音乐、播客等。",
          "type": "string"
        },
        {
          "const": "book",
          "description": "书籍类型，如电子书、小说等。",
          "type": "string"
        },
        {
          "const": "manga",
          "description": "漫画类型，如漫画、图画书等。",
          "type": "string"
        }
      ]
    },
    "Meta": {
      "additionalProperties": false,
      "description": "元数据 (Meta)\n描述规则的基本信息。",
      "properties": {
        "author": {
          "description": "规则作者。",
          "type": "string"
        },
        "description": {
          "description": "规则的详细描述。",
          "type": [
            "string",
            "null"
          ]
        },
        "domain": {
          "description": "目标网站的主域名。",
          "type": "string"
        },
        "encoding": {
          "description": "目标网站的编码，默认为 \"UTF-8\"。",
          "type": [
            "string",
            "null"
          ]
        },
        "icon_url": {
          "description": "数据源的图标URL，用于UI展示。",
          "type": [
            "string",
            "null"
          ]
        },
        "media_type": {
          "$ref": "#/$defs/MediaType",
          "description": "规则用于的媒体类型。"
        },
        "name": {
          "description": "规则名称，如“示例影视站”。",
          "type": "string"
        },
        "spec_version": {
          "description": "本规则遵循的规范版本号。",
          "type": "string"
        },
        "version": {
          "description": "规则版本号，建议遵循 SemVer (如 \"1.0.2\")。",
          "type": "string"
        }
      },
      "required": [
        "name",
        "author",
        "version",
        "spec_version",
        "domain",
        "media_type"
      ],
      "type": "object"
    },
    "NestedOptionList": {
      "additionalProperties": false,
      "description": "嵌套选项列表（用于筛选组内的选项）",
      "properties": {
        "fields": {
          "$ref": "#/$defs/FilterOptionFields",
          "description": "选项字段提取规则"
        },
        "list": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "选项列表提取规则"
        }
      },
      "required": [
        "list",
        "fields"
      ],
      "type": "object"
    },
    "OptionFields": {
      "additionalProperties": false,
      "description": "选项字段定义（用于动态提取）",
      "properties": {
        "key": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "选项标识提取规则"
        },
        "label": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "显示名称提取规则"
        },
        "value": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldExtractor"
            },
            {
              "type": "null"
            }
          ],
          "description": "请求值提取规则（可选）"
        }
      },
      "required": [
        "key",
        "label"
      ],
      "type": "object"
    },
    "OptionItem": {
      "additionalProperties": false,
      "description": "选项项（静态定义）",
      "properties": {
        "key": {
          "description": "选项标识（用于 URL 参数）",
          "type": "string"
        },
        "label": {
          "description": "显示名称",
          "type": "string"
        },
        "value": {
          "description": "请求值（可选，默认使用 key）",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "key",
        "label"
      ],
      "type": "object"
    },
    "OptionList": {
      "anyOf": [
        {
          "description": "静态选项列表",
          "items": {
            "$ref": "#/$defs/OptionItem"
          },
          "type": "array"
        },
        {
          "$ref": "#/$defs/DynamicOptionList",
          "description": "动态获取配置"
        }
      ],
      "description": "选项列表\n\n支持静态定义或从数据源动态获取\n\n# 示例\n\n## 静态定义\n```toml\ncategories = [\n  { key = \"movie\", label = \"电影\" },\n  { key = \"tv\", label = \"电视剧\" },\n]\n```\n\n## 动态获取（HTML）\n```toml\n[categories]\nurl = \"https://example.com/categories\"\nlist.steps = [{ css = \".category-item\" }]\n\n[categories.fields]\nkey.steps = [{ attr = \"data-id\" }]\nlabel.steps = [{ css = \".name\" }]\n```\n\n## 动态获取（JSON API）\n```toml\n[categories]\nurl = \"https://api.example.com/categories\"\nlist.steps = [{ json = \"$.data.categories[*]\" }]\n\n[categories.fields]\nkey.steps = [{ json = \"$.id\" }]\nlabel.steps = [{ json = \"$.name\" }]\n```"
    },
    "PaginationConfig": {
      "additionalProperties": false,
      "description": "分页配置",
      "properties": {
        "max_pages": {
          "description": "最大页数限制",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "page_param": {
          "default": "page",
          "description": "页码参数名",
          "type": "string"
        },
        "page_size": {
          "description": "每页数量（如果适用）",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "pagination_type": {
          "$ref": "#/$defs/PaginationType",
          "default": "page_number",
          "description": "分页类型"
        },
        "start_page": {
          "default": 1,
          "description": "起始页码",
          "format": "uint32",
          "minimum": 0,
          "type": "integer"
        }
      },
      "type": "object"
    },
    "PaginationType": {
      "description": "分页类型",
      "oneOf": [
        {
          "const": "page_number",
          "description": "页码分页",
          "type": "string"
        },
        {
          "const": "offset",
          "description": "偏移量分页",
          "type": "string"
        },
        {
          "const": "cursor",
          "description": "游标分页",
          "type": "string"
        }
      ]
    },
    "PlayLineListRule": {
      "additionalProperties": false,
      "description": "播放线路列表提取规则 (PlayLineListRule)\n定义如何提取播放线路和剧集",
      "properties": {
        "episodes": {
          "$ref": "#/$defs/EpisodeListRule",
          "description": "剧集列表的提取规则（相对于单个线路元素）"
        },
        "line_name": {
          "$ref": "#/$defs/FieldRule",
          "description": "线路名称的提取规则（相对于单个线路元素）"
        },
        "lines": {
          "$ref": "#/$defs/FieldRule",
          "description": "线路列表容器的提取流程"
        }
      },
      "required": [
        "lines",
        "line_name",
        "episodes"
      ],
      "type": "object"
    },
    "RegexStep": {
      "anyOf": [
        {
          "description": "简单正则（默认取第1组）",
          "type": "string"
        },
        {
          "description": "带配置的正则",
          "properties": {
            "global": {
              "default": false,
              "description": "是否全局匹配",
              "type": "boolean"
            },
            "group": {
              "default": 1,
              "description": "捕获组索引（默认 1）",
              "format": "uint",
              "minimum": 0,
              "type": "integer"
            },
            "pattern": {
              "description": "正则表达式模式",
              "type": "string"
            }
          },
          "required": [
            "pattern"
          ],
          "type": "object"
        }
      ],
      "description": "正则表达式步骤"
    },
    "Script": {
      "anyOf": [
        {
          "description": "简单代码字符串\n直接作为脚本代码执行（使用默认引擎）",
          "type": "string"
        },
        {
          "$ref": "#/$defs/ScriptConfig",
          "description": "完整配置"
        }
      ],
      "description": "脚本调用配置\n\n自包含的脚本定义，支持多种形式：\n\n# 示例\n\n## 最简形式：直接写代码字符串\n```toml\nscript = \"return input.trim().toUpperCase()\"\n```\n\n## 内联代码（显式指定引擎）\n```toml\n[script]\ncode = '''\nlet result = input.split(\",\");\nreturn result.map(s => s.trim());\n'''\nengine = \"javascript\"\n```\n\n## 引用外部文件\n```toml\nscript = { file = \"./scripts/login.js\" }\n```\n\n## 远程脚本\n```toml\nscript = { url = \"https://example.com/scripts/utils.js\", function = \"processData\" }\n```\n\n## 带参数调用\n```toml\n[script]\ncode = \"return input.replace(params.from, params.to)\"\nparams = { from = \"old\", to = \"new\" }\n```"
    },
    "ScriptConfig": {
      "description": "脚本完整配置",
      "oneOf": [
        {
          "description": "内联代码",
          "properties": {
            "code": {
              "type": "string"
            }
          },
          "required": [
            "code"
          ],
          "type": "object"
        },
        {
          "description": "本地文件路径（相对于规则文件）",
          "properties": {
            "file": {
              "type": "string"
            }
          },
          "required": [
            "file"
          ],
          "type": "object"
        },
        {
          "description": "远程 URL",
          "properties": {
            "url": {
              "type": "string"
            }
          },
          "required": [
            "url"
          ],
          "type": "object"
        }
      ],
      "properties": {
        "engine": {
          "anyOf": [
            {
              "$ref": "#/$defs/ScriptEngine"
            },
            {
              "type": "null"
            }
          ],
          "description": "脚本引擎（可选，默认 JavaScript）"
        },
        "function": {
          "description": "要调用的函数名（可选）\n如果脚本定义了多个函数，指定要调用的函数\n默认调用 `main` 或直接执行脚本",
          "type": [
            "string",
            "null"
          ]
        },
        "params": {
          "additionalProperties": true,
          "description": "传递给脚本的参数（可选）",
          "type": [
            "object",
            "null"
          ]
        }
      },
      "type": "object",
      "unevaluatedProperties": false
    },
    "ScriptEngine": {
      "description": "脚本引擎类型\n\n指定脚本执行环境，默认为 JavaScript。",
      "oneOf": [
        {
          "const": "javascript",
          "description": "JavaScript 脚本引擎（默认，使用 Boa）",
          "type": "string"
        },
        {
          "const": "rhai",
          "description": "Rhai 脚本引擎（轻量级，Rust 原生）",
          "type": "string"
        },
        {
          "const": "lua",
          "description": "Lua 脚本引擎",
          "type": "string"
        }
      ]
    },
    "SearchFlow": {
      "additionalProperties": false,
      "description": "搜索流程 (SearchFlow)\n实现搜索功能\n\n# 示例\n\n```toml\n[search]\nurl = \"https://example.com/search?q={{ keyword }}&page={{ page }}\"\n\n[search.pagination]\npagination_type = \"page_number\"\n\n[search.fields]\ntitle.steps = [{ css = \".title\" }]\nurl.steps = [{ css = \"a\" }, { attr = \"href\" }]\n```",
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/ItemFields",
          "description": "将列表项映射为最终数据结构的字段提取规则"
        },
        "list": {
          "$ref": "#/$defs/FieldExtractor",
          "description": "list 列表提取规则"
        },
        "pagination": {
          "anyOf": [
            {
              "$ref": "#/$defs/PaginationConfig"
            },
            {
              "type": "null"
            }
          ],
          "description": "分页配置（可选）"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "搜索 URL 模板\n约定输入变量: {{ keyword }}, {{ page }}"
        }
      },
      "required": [
        "url",
        "list",
        "fields"
      ],
      "type": "object"
    },
    "SelectorStep": {
      "anyOf": [
        {
          "description": "简单选择器字符串",
          "type": "string"
        },
        {
          "description": "带配置的选择器",
          "properties": {
            "all": {
              "default": false,
              "description": "是否选择所有匹配（默认 false）",
              "type": "boolean"
            },
            "selector": {
              "description": "选择器表达式",
              "type": "string"
            }
          },
          "required": [
            "selector"
          ],
          "type": "object"
        }
      ],
      "description": "选择器步骤（CSS/JSONPath/XPath 通用）"
    },
    "Template": {
      "description": "模板字符串 (Template)\n\n支持 Tera 模板语法的字符串类型，用于在运行时进行变量插值。\n\n## 语法规范\n- 变量插值: `{{ variable }}`\n- 嵌套访问: `{{ user.name }}`, `{{ items[0] }}`\n- 过滤器: `{{ name | upper }}`\n- 条件: `{% if condition %}...{% endif %}`\n- 循环: `{% for item in items %}...{% endfor %}`\n\n## 示例\n```text\nhttps://example.com/search?q={{ keyword }}\nHello, {{ user.name }}!\n{{ items[0].title }}\n```",
      "pattern": "{{\\s*([a-zA-Z_][a-zA-Z0-9_]*(?:\\.[a-zA-Z_][a-zA-Z0-9_]*|\\[[0-9]+\\])*)\\s*}}",
      "type": "string"
    },
    "TrackListRule": {
      "additionalProperties": false,
      "description": "音轨列表提取规则 (TrackListRule)",
      "properties": {
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "时长的提取规则（可选）"
        },
        "list": {
          "$ref": "#/$defs/FieldRule",
          "description": "音轨列表的提取流程"
        },
        "name": {
          "$ref": "#/$defs/FieldRule",
          "description": "音轨名称的提取规则"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "音轨 URL 的提取规则"
        }
      },
      "required": [
        "list",
        "name",
        "url"
      ],
      "type": "object"
    }
  },
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "description": "影视软件爬虫规则 (CrawlerRule)",
  "properties": {
    "content": {
      "anyOf": [
        {
          "$ref": "#/$defs/ContentFlow"
        },
        {
          "type": "null"
        }
      ],
      "description": "内容页流程（可选）\n用于播放页、阅读页等需要进一步解析内容的场景"
    },
    "detail": {
      "$ref": "#/$defs/DetailFlow",
      "description": "详情页流程（必需）"
    },
    "discovery": {
      "anyOf": [
        {
          "$ref": "#/$defs/DiscoveryFlow"
        },
        {
          "type": "null"
        }
      ],
      "description": "发现页流程（可选）\n提供筛选器和分页配置"
    },
    "http": {
      "anyOf": [
        {
          "$ref": "#/$defs/HttpConfig"
        },
        {
          "type": "null"
        }
      ],
      "description": "全局的网络请求配置，可被流程局部配置覆盖。"
    },
    "login": {
      "anyOf": [
        {
          "$ref": "#/$defs/LoginFlow"
        },
        {
          "type": "null"
        }
      ],
      "description": "登录流程（可选）"
    },
    "meta": {
      "$ref": "#/$defs/Meta",
      "description": "规则的元数据，用于在软件中识别和展示。"
    },
    "search": {
      "$ref": "#/$defs/SearchFlow",
      "description": "搜索流程（必需）"
    }
  },
  "required": [
    "meta",
    "detail",
    "search"
  ],
  "title": "CrawlerRule",
  "type": "object"
}
