{
  "$comment": "Schema version: 1.0.0",
  "$defs": {
    "CategoryFields": {
      "additionalProperties": false,
      "description": "分类字段定义",
      "properties": {
        "key": {
          "description": "分类标识提取规则",
          "type": "string"
        },
        "label": {
          "description": "分类名称提取规则",
          "type": "string"
        },
        "value": {
          "description": "分类值提取规则（可选）",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "key",
        "label"
      ],
      "type": "object"
    },
    "CategoryItem": {
      "additionalProperties": false,
      "description": "分类项",
      "properties": {
        "key": {
          "description": "分类唯一标识（用于请求参数）",
          "type": "string"
        },
        "label": {
          "description": "展示名称",
          "type": "string"
        },
        "value": {
          "description": "可选：请求使用的值（不提供则默认用 key）",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "key",
        "label"
      ],
      "type": "object"
    },
    "CategorySource": {
      "description": "分类来源定义",
      "oneOf": [
        {
          "description": "静态分类（手动配置）",
          "properties": {
            "items": {
              "items": {
                "$ref": "#/$defs/CategoryItem"
              },
              "type": "array"
            },
            "type": {
              "const": "static",
              "type": "string"
            }
          },
          "required": [
            "type",
            "items"
          ],
          "type": "object"
        },
        {
          "description": "动态分类（从页面提取）",
          "properties": {
            "fields": {
              "$ref": "#/$defs/CategoryFields",
              "description": "分类项字段定义"
            },
            "selector": {
              "description": "分类列表选择器",
              "type": "string"
            },
            "type": {
              "const": "dynamic",
              "type": "string"
            },
            "url": {
              "$ref": "#/$defs/Template",
              "description": "分类数据源 URL"
            }
          },
          "required": [
            "type",
            "url",
            "selector",
            "fields"
          ],
          "type": "object"
        }
      ]
    },
    "ChapterListRule": {
      "additionalProperties": false,
      "description": "章节列表提取规则 (ChapterListRule)\n定义如何提取章节列表",
      "properties": {
        "list": {
          "$ref": "#/$defs/FieldRule",
          "description": "章节列表容器的提取流程\n应返回一个包含多个章节元素的数组"
        },
        "title": {
          "$ref": "#/$defs/FieldRule",
          "description": "章节标题的提取规则（相对于单个章节元素）"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "章节 URL 的提取规则（相对于单个章节元素）"
        }
      },
      "required": [
        "list",
        "title",
        "url"
      ],
      "type": "object"
    },
    "ContentFields": {
      "description": "内容页字段规则 (ContentFields)\n用于播放页、阅读页等内容消费页面\n\n使用 Box 包装以减少枚举大小差异",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "视频播放字段",
          "properties": {
            "media_type": {
              "const": "video",
              "type": "string"
            },
            "play_url": {
              "$ref": "#/$defs/FieldRule",
              "description": "播放地址（必需）"
            },
            "quality": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "画质信息（可选）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "视频标题（可选）"
            }
          },
          "required": [
            "media_type",
            "play_url"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "音频播放字段",
          "properties": {
            "artist": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "艺术家（可选）"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面图（可选）"
            },
            "duration": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "时长（可选）"
            },
            "lyrics": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "歌词/文本内容（可选）"
            },
            "media_type": {
              "const": "audio",
              "type": "string"
            },
            "play_url": {
              "$ref": "#/$defs/FieldRule",
              "description": "播放地址（必需）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "音频标题（可选）"
            }
          },
          "required": [
            "media_type",
            "play_url"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "书籍正文字段",
          "properties": {
            "content": {
              "$ref": "#/$defs/FieldRule",
              "description": "正文内容（必需）"
            },
            "media_type": {
              "const": "book",
              "type": "string"
            },
            "next_page_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "下一页 URL（用于分页章节）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节标题（可选，可能需要从正文页重新获取）"
            }
          },
          "required": [
            "media_type",
            "content"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "漫画阅读字段",
          "properties": {
            "images": {
              "$ref": "#/$defs/FieldRule",
              "description": "图片列表（必需）"
            },
            "media_type": {
              "const": "manga",
              "type": "string"
            },
            "next_chapter_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "下一章 URL（可选）"
            },
            "prev_chapter_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "上一章 URL（可选）"
            },
            "title": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节标题（可选）"
            }
          },
          "required": [
            "media_type",
            "images"
          ],
          "type": "object"
        }
      ]
    },
    "ContentFlow": {
      "additionalProperties": false,
      "description": "内容页流程 (ContentFlow)\n用于播放页、阅读页等内容消费页面\n\n例如：\n- 视频：解析真实播放地址\n- 书籍：获取章节正文内容\n- 漫画：获取章节图片列表\n- 音频：获取音频播放地址\n\n# 示例\n\n```toml\n[content]\nurl = \"{{ play_url }}\"\n\n[content.fields]\nmedia_type = \"video\"\nplay_url.steps = [{ css = \"#player\" }, { attr = \"src\" }, { filter = \"absolute_url\" }]\n```",
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/ContentFields",
          "description": "内容字段提取规则"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "内容页 URL 模板\n约定输入变量: {{ play_url }} 或 {{ chapter_url }}"
        }
      },
      "required": [
        "url",
        "fields"
      ],
      "type": "object"
    },
    "CredentialLogin": {
      "additionalProperties": false,
      "description": "凭证登录配置",
      "properties": {
        "credential_type": {
          "$ref": "#/$defs/CredentialType",
          "description": "凭证类型"
        },
        "fields": {
          "description": "用户需要提供的字段",
          "items": {
            "$ref": "#/$defs/LoginField"
          },
          "type": "array"
        }
      },
      "required": [
        "credential_type",
        "fields"
      ],
      "type": "object"
    },
    "CredentialType": {
      "description": "凭证类型",
      "oneOf": [
        {
          "const": "cookie",
          "description": "Cookie",
          "type": "string"
        },
        {
          "const": "token",
          "description": "Token (如 JWT)",
          "type": "string"
        },
        {
          "const": "api_key",
          "description": "API Key",
          "type": "string"
        },
        {
          "const": "custom",
          "description": "自定义",
          "type": "string"
        }
      ]
    },
    "DetailFields": {
      "description": "详情页字段规则 (DetailFields)\n根据媒体类型使用不同的字段定义\n\n使用 Box 包装以减少枚举大小差异",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "视频详情字段",
          "properties": {
            "actors": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "演员"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类/类型"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面/海报"
            },
            "director": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "导演"
            },
            "duration": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "时长"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/剧情介绍"
            },
            "language": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "语言"
            },
            "media_type": {
              "const": "video",
              "type": "string"
            },
            "play_lines": {
              "anyOf": [
                {
                  "$ref": "#/$defs/PlayLineListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "播放线路列表提取规则"
            },
            "region": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "地区"
            },
            "score": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "评分"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "片名（必需）"
            },
            "update_info": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新信息/集数状态"
            },
            "year": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "年份"
            }
          },
          "required": [
            "media_type",
            "title"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "音频详情字段",
          "properties": {
            "album": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "专辑名"
            },
            "artist": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "艺术家/作者"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/描述"
            },
            "media_type": {
              "const": "audio",
              "type": "string"
            },
            "play_count": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "播放量"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "标题（必需）"
            },
            "tracks": {
              "anyOf": [
                {
                  "$ref": "#/$defs/TrackListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "音轨列表提取规则"
            },
            "update_time": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新时间"
            }
          },
          "required": [
            "media_type",
            "title"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "书籍详情字段",
          "properties": {
            "author": {
              "$ref": "#/$defs/FieldRule",
              "description": "作者（必需）"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类/类型"
            },
            "chapters": {
              "anyOf": [
                {
                  "$ref": "#/$defs/ChapterListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节列表提取规则"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面图 URL"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/描述"
            },
            "last_chapter": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "最新章节名"
            },
            "media_type": {
              "const": "book",
              "type": "string"
            },
            "status": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "连载状态"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "书名（必需）"
            },
            "toc_url": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "目录页 URL（如果目录在单独页面）"
            },
            "update_time": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新时间"
            },
            "word_count": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "字数"
            }
          },
          "required": [
            "media_type",
            "title",
            "author"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "漫画详情字段",
          "properties": {
            "author": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "作者"
            },
            "category": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "分类"
            },
            "chapters": {
              "anyOf": [
                {
                  "$ref": "#/$defs/ChapterListRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "章节列表提取规则"
            },
            "cover": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "封面"
            },
            "intro": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "简介/描述"
            },
            "last_chapter": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "最新章节"
            },
            "media_type": {
              "const": "manga",
              "type": "string"
            },
            "status": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "连载状态"
            },
            "tags": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "标签列表"
            },
            "title": {
              "$ref": "#/$defs/FieldRule",
              "description": "漫画名（必需）"
            },
            "update_time": {
              "anyOf": [
                {
                  "$ref": "#/$defs/FieldRule"
                },
                {
                  "type": "null"
                }
              ],
              "description": "更新时间"
            }
          },
          "required": [
            "media_type",
            "title"
          ],
          "type": "object"
        }
      ]
    },
    "DetailFlow": {
      "additionalProperties": false,
      "description": "详情页流程 (DetailFlow)\n处理单个内容项的详细信息\n\n# 示例\n\n```toml\n[detail]\nurl = \"{{ detail_url }}\"\n\n[detail.fields]\nmedia_type = \"video\"\ntitle.steps = [{ css = \".title\" }, { filter = \"trim\" }]\ncover.steps = [{ css = \".poster img\" }, { attr = \"src\" }, { filter = \"absolute_url\" }]\n```",
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/DetailFields",
          "description": "字段提取规则\n根据媒体类型定义不同的字段集合"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "详情页 URL 模板\n约定输入变量: {{ detail_url }}"
        }
      },
      "required": [
        "url",
        "fields"
      ],
      "type": "object"
    },
    "DiscoveryFlow": {
      "additionalProperties": false,
      "description": "发现页流程 (DiscoveryFlow)\n用于列表页、分类页、发现页等场景\n\n# 示例\n\n```toml\n[discovery]\nurl = \"https://example.com/category/{{ category }}?page={{ page }}\"\n\n[discovery.pagination]\npagination_type = \"page_number\"\nstart_page = 1\n\n[discovery.fields]\ntitle.steps = [{ css = \".title\" }, { filter = \"trim\" }]\nurl.steps = [{ css = \"a\" }, { attr = \"href\" }, { filter = \"absolute_url\" }]\n```",
      "properties": {
        "categories": {
          "anyOf": [
            {
              "$ref": "#/$defs/CategorySource"
            },
            {
              "type": "null"
            }
          ],
          "description": "分类来源（可选）"
        },
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/ItemFields",
          "description": "列表项字段定义"
        },
        "filters": {
          "anyOf": [
            {
              "$ref": "#/$defs/FiltersSource"
            },
            {
              "type": "null"
            }
          ],
          "description": "动态筛选器（可选）"
        },
        "pagination": {
          "anyOf": [
            {
              "$ref": "#/$defs/PaginationConfig"
            },
            {
              "type": "null"
            }
          ],
          "description": "分页配置（可选）"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "数据源 URL 模板\n支持变量: {{ category }}, {{ page }}, 自定义筛选器变量"
        }
      },
      "required": [
        "url",
        "fields"
      ],
      "type": "object"
    },
    "EpisodeListRule": {
      "additionalProperties": false,
      "description": "剧集列表提取规则 (EpisodeListRule)",
      "properties": {
        "list": {
          "$ref": "#/$defs/FieldRule",
          "description": "剧集列表的提取流程"
        },
        "name": {
          "$ref": "#/$defs/FieldRule",
          "description": "剧集名称的提取规则"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "剧集播放页 URL 的提取规则"
        }
      },
      "required": [
        "list",
        "name",
        "url"
      ],
      "type": "object"
    },
    "ExtractStep": {
      "description": "提取步骤 (ExtractStep)\n\n单个原子化操作。步骤类型：\n- **选择步骤**：css, json, xpath, regex\n- **过滤步骤**：filter, attr, index\n- **特殊步骤**：const, var, script",
      "oneOf": [
        {
          "additionalProperties": false,
          "description": "CSS 选择器（HTML）",
          "properties": {
            "css": {
              "$ref": "#/$defs/SelectorStep"
            }
          },
          "required": [
            "css"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "JSONPath 表达式（JSON）",
          "properties": {
            "json": {
              "$ref": "#/$defs/SelectorStep"
            }
          },
          "required": [
            "json"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "XPath 表达式（XML/HTML）",
          "properties": {
            "xpath": {
              "$ref": "#/$defs/SelectorStep"
            }
          },
          "required": [
            "xpath"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "正则表达式（文本）",
          "properties": {
            "regex": {
              "$ref": "#/$defs/RegexStep"
            }
          },
          "required": [
            "regex"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "过滤器管道",
          "properties": {
            "filter": {
              "$ref": "#/$defs/FilterStep"
            }
          },
          "required": [
            "filter"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "属性提取",
          "properties": {
            "attr": {
              "type": "string"
            }
          },
          "required": [
            "attr"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "索引/切片",
          "properties": {
            "index": {
              "$ref": "#/$defs/IndexStep"
            }
          },
          "required": [
            "index"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "常量值",
          "properties": {
            "const": true
          },
          "required": [
            "const"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "上下文变量",
          "properties": {
            "var": {
              "type": "string"
            }
          },
          "required": [
            "var"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "description": "脚本调用",
          "properties": {
            "script": {
              "$ref": "#/$defs/ScriptStep"
            }
          },
          "required": [
            "script"
          ],
          "type": "object"
        }
      ]
    },
    "FieldExtractor": {
      "additionalProperties": false,
      "description": "字段提取器 (FieldExtractor)\n\n定义如何从响应数据中提取单个字段的值。\n通过步骤列表定义提取流程。\n\n# 示例\n\n```toml\n# 单步骤\ntitle.steps = [{ css = \".title\" }]\n\n# 多步骤\ncover.steps = [\n    { css = \"img\" },\n    { attr = \"src\" },\n    { filter = \"absolute_url\" }\n]\n\n# 带回退和默认值\nauthor.steps = [{ css = \".author\" }]\nauthor.fallback = [\n    [{ css = \".writer\" }],\n    [{ css = \".creator\" }]\n]\nauthor.default = \"佚名\"\n```",
      "properties": {
        "default": {
          "description": "默认值\n\n所有提取（包括回退）都失败时使用此值"
        },
        "fallback": {
          "description": "回退步骤链\n\n当主步骤提取失败（结果为空或 null）时，按顺序尝试这些备选流程",
          "items": {
            "items": {
              "$ref": "#/$defs/ExtractStep"
            },
            "type": "array"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "nullable": {
          "default": false,
          "description": "是否允许空值",
          "type": "boolean"
        },
        "steps": {
          "description": "提取步骤列表\n\n按顺序执行，前一步骤的输出作为后一步骤的输入",
          "items": {
            "$ref": "#/$defs/ExtractStep"
          },
          "type": "array"
        }
      },
      "required": [
        "steps"
      ],
      "type": "object"
    },
    "FieldRule": {
      "$ref": "#/$defs/FieldExtractor",
      "description": "字段规则 (FieldRule)\n定义单个字段的提取方式\n\n`FieldRule` 是 `FieldExtractor` 的透明包装，提供更语义化的类型名。\n\n# 示例\n\n```toml\n# 单步骤提取\ntitle.steps = [{ css = \".title\" }, { filter = \"trim\" }]\n\n# 带回退和默认值\ncover.steps = [{ css = \".poster img\" }, { attr = \"src\" }, { filter = \"absolute_url\" }]\ncover.fallback = [[{ css = \".thumbnail\" }, { attr = \"src\" }]]\ncover.default = \"/default-cover.jpg\"\n```"
    },
    "FilterConfig": {
      "additionalProperties": false,
      "description": "过滤器配置（结构化形式）",
      "properties": {
        "args": {
          "description": "过滤器参数",
          "items": true,
          "type": [
            "array",
            "null"
          ]
        },
        "name": {
          "description": "过滤器名称",
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "type": "object"
    },
    "FilterGroup": {
      "additionalProperties": false,
      "description": "筛选器组 (FilterGroup)\n代表UI上一组相关的筛选选项，如\"地区\"、\"年份\"。",
      "properties": {
        "key": {
          "description": "此筛选器组在URL模板中对应的键 (`key`)。",
          "type": "string"
        },
        "multiselect": {
          "default": false,
          "description": "是否允许多选。",
          "type": "boolean"
        },
        "name": {
          "description": "筛选器组的显示名称，如 \"按类型\"。",
          "type": "string"
        },
        "options": {
          "description": "此筛选器组下所有可用的选项。",
          "items": {
            "$ref": "#/$defs/FilterOption"
          },
          "type": "array"
        }
      },
      "required": [
        "name",
        "key",
        "options"
      ],
      "type": "object"
    },
    "FilterGroupFields": {
      "additionalProperties": false,
      "description": "筛选组字段定义",
      "properties": {
        "key": {
          "description": "筛选组key提取规则",
          "type": "string"
        },
        "name": {
          "description": "筛选组名称提取规则",
          "type": "string"
        },
        "option_fields": {
          "$ref": "#/$defs/FilterOptionFields",
          "description": "选项字段定义"
        },
        "options_selector": {
          "description": "选项列表选择器",
          "type": "string"
        }
      },
      "required": [
        "name",
        "key",
        "options_selector",
        "option_fields"
      ],
      "type": "object"
    },
    "FilterOption": {
      "additionalProperties": false,
      "description": "筛选器选项 (FilterOption)\n代表一个具体的筛选选项，如\"电影\"或\"2023年\"。",
      "properties": {
        "name": {
          "description": "选项的显示名称，如 \"美国\"。",
          "type": "string"
        },
        "value": {
          "description": "选项的值，将用于替换URL模板中对应的 `key`。",
          "type": "string"
        }
      },
      "required": [
        "name",
        "value"
      ],
      "type": "object"
    },
    "FilterOptionFields": {
      "additionalProperties": false,
      "description": "筛选选项字段定义",
      "properties": {
        "name": {
          "description": "选项名称提取规则",
          "type": "string"
        },
        "value": {
          "description": "选项值提取规则",
          "type": "string"
        }
      },
      "required": [
        "name",
        "value"
      ],
      "type": "object"
    },
    "FilterStep": {
      "anyOf": [
        {
          "description": "管道字符串：`\"trim | lower | replace(a, b)\"`",
          "type": "string"
        },
        {
          "description": "过滤器数组（复杂参数场景）",
          "items": {
            "$ref": "#/$defs/FilterConfig"
          },
          "type": "array"
        }
      ],
      "description": "过滤器步骤"
    },
    "FiltersSource": {
      "description": "筛选器来源定义",
      "oneOf": [
        {
          "description": "静态筛选组",
          "properties": {
            "groups": {
              "items": {
                "$ref": "#/$defs/FilterGroup"
              },
              "type": "array"
            },
            "type": {
              "const": "static",
              "type": "string"
            }
          },
          "required": [
            "type",
            "groups"
          ],
          "type": "object"
        },
        {
          "description": "动态筛选组（从页面提取）",
          "properties": {
            "fields": {
              "$ref": "#/$defs/FilterGroupFields",
              "description": "筛选组字段定义"
            },
            "selector": {
              "description": "筛选组列表选择器",
              "type": "string"
            },
            "type": {
              "const": "dynamic",
              "type": "string"
            },
            "url": {
              "$ref": "#/$defs/Template",
              "description": "筛选器数据源 URL"
            }
          },
          "required": [
            "type",
            "url",
            "selector",
            "fields"
          ],
          "type": "object"
        }
      ]
    },
    "FormLogin": {
      "additionalProperties": false,
      "description": "表单登录配置",
      "properties": {
        "field_mapping": {
          "additionalProperties": {
            "$ref": "#/$defs/Template"
          },
          "description": "表单字段映射\nkey: 接口参数名, value: 用户输入字段key",
          "type": "object"
        },
        "fields": {
          "description": "用户输入字段定义",
          "items": {
            "$ref": "#/$defs/LoginField"
          },
          "type": "array"
        },
        "method": {
          "anyOf": [
            {
              "$ref": "#/$defs/HttpMethod"
            },
            {
              "type": "null"
            }
          ],
          "description": "HTTP 方法（默认 POST）"
        },
        "success_check": {
          "anyOf": [
            {
              "$ref": "#/$defs/SuccessCheck"
            },
            {
              "type": "null"
            }
          ],
          "description": "登录成功检测"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "登录接口 URL"
        }
      },
      "required": [
        "url",
        "fields",
        "field_mapping"
      ],
      "type": "object"
    },
    "HttpConfig": {
      "additionalProperties": false,
      "description": "全局HTTP配置 (HttpConfig)\n定义所有网络请求的默认行为。",
      "properties": {
        "connect_timeout": {
          "description": "连接超时时间（秒）。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "follow_redirects": {
          "description": "是否允许重定向。",
          "type": [
            "boolean",
            "null"
          ]
        },
        "headers": {
          "additionalProperties": {
            "type": "string"
          },
          "description": "全局请求头。",
          "type": [
            "object",
            "null"
          ]
        },
        "max_concurrent": {
          "description": "最大并发请求数。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "max_redirects": {
          "description": "最大重定向次数。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "proxy": {
          "description": "全局代理地址。",
          "type": [
            "string",
            "null"
          ]
        },
        "request_delay": {
          "description": "请求间隔时间（毫秒），用于限流。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "retry_count": {
          "description": "重试次数。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "retry_delay": {
          "description": "重试间隔（毫秒）。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "timeout": {
          "description": "全局请求超时时间（秒）。",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "user_agent": {
          "description": "全局 User-Agent。",
          "type": [
            "string",
            "null"
          ]
        },
        "verify_ssl": {
          "description": "是否验证SSL证书。",
          "type": [
            "boolean",
            "null"
          ]
        }
      },
      "type": "object"
    },
    "HttpMethod": {
      "description": "HTTP 请求方法 (HttpMethod)\n用于指定网络请求的 HTTP 方法。",
      "oneOf": [
        {
          "const": "GET",
          "description": "GET 请求，通常用于获取数据。",
          "type": "string"
        },
        {
          "const": "POST",
          "description": "POST 请求，通常用于提交数据。",
          "type": "string"
        },
        {
          "const": "PUT",
          "description": "PUT 请求，通常用于更新数据。",
          "type": "string"
        },
        {
          "const": "DELETE",
          "description": "DELETE 请求，通常用于删除数据。",
          "type": "string"
        },
        {
          "const": "HEAD",
          "description": "HEAD 请求，类似于 GET，但只获取响应头。",
          "type": "string"
        },
        {
          "const": "OPTIONS",
          "description": "OPTIONS 请求，获取服务器支持的HTTP方法。",
          "type": "string"
        },
        {
          "const": "PATCH",
          "description": "PATCH 请求，用于部分更新数据。",
          "type": "string"
        }
      ]
    },
    "IndexStep": {
      "anyOf": [
        {
          "description": "单个索引",
          "format": "int32",
          "type": "integer"
        },
        {
          "description": "切片表达式 \"start:end\" 或 \"start:end:step\"",
          "type": "string"
        }
      ],
      "description": "索引/切片步骤"
    },
    "ItemFields": {
      "additionalProperties": false,
      "description": "列表项字段规则 (ItemFields)\n定义列表页中每个项目需要提取的字段\n这些字段将构成 ItemSummary",
      "properties": {
        "author": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "作者/创作者（书籍、漫画、音频常用）"
        },
        "category": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "分类/标签（返回字符串，多个标签用分隔符分开）"
        },
        "cover": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "封面图 URL"
        },
        "extra": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "扩展字段（用于媒体类型特定的额外信息）"
        },
        "latest": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "最新章节/更新信息"
        },
        "score": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "评分"
        },
        "status": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "状态（连载中/已完结等）"
        },
        "summary": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "简介/摘要"
        },
        "title": {
          "$ref": "#/$defs/FieldRule",
          "description": "标题（必需）"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "详情页 URL（必需）"
        }
      },
      "required": [
        "title",
        "url"
      ],
      "type": "object"
    },
    "LoginField": {
      "additionalProperties": false,
      "description": "登录字段定义\n用于 App 生成用户输入表单",
      "properties": {
        "field_type": {
          "$ref": "#/$defs/LoginFieldType",
          "default": "text",
          "description": "字段类型"
        },
        "key": {
          "description": "字段标识符（变量名）",
          "type": "string"
        },
        "label": {
          "description": "字段显示名称",
          "type": "string"
        },
        "placeholder": {
          "description": "占位符文本",
          "type": [
            "string",
            "null"
          ]
        },
        "required": {
          "default": true,
          "description": "是否必填",
          "type": "boolean"
        }
      },
      "required": [
        "key",
        "label"
      ],
      "type": "object"
    },
    "LoginFieldType": {
      "description": "登录字段类型",
      "oneOf": [
        {
          "const": "text",
          "description": "普通文本",
          "type": "string"
        },
        {
          "const": "password",
          "description": "密码（隐藏显示）",
          "type": "string"
        },
        {
          "const": "textarea",
          "description": "多行文本（如 Cookie 字符串、Token）",
          "type": "string"
        }
      ]
    },
    "LoginFlow": {
      "description": "登录流程 (LoginFlow)\n提供三种常见登录模式\n\n# 示例\n\n```yaml\n# WebView 登录\nlogin:\n  webview:\n    url: \"https://example.com/login\"\n\n# 表单登录\nlogin:\n  form:\n    url: \"https://example.com/api/login\"\n    method: POST\n    fields:\n      username: \"{{ username }}\"\n      password: \"{{ password }}\"\n\n# 凭证登录\nlogin:\n  credential:\n    type: cookie\n    fields:\n      - key: session_id\n        label: \"会话ID\"\n```",
      "oneOf": [
        {
          "description": "WebView 登录\nApp 打开内嵌浏览器，用户手动登录",
          "properties": {
            "webview": {
              "$ref": "#/$defs/WebViewLogin"
            }
          },
          "required": [
            "webview"
          ],
          "type": "object"
        },
        {
          "description": "表单登录\n通过 HTTP 表单提交用户凭证",
          "properties": {
            "form": {
              "$ref": "#/$defs/FormLogin"
            }
          },
          "required": [
            "form"
          ],
          "type": "object"
        },
        {
          "description": "凭证登录\n用户手动提供认证信息（Cookie/Token等）",
          "properties": {
            "credential": {
              "$ref": "#/$defs/CredentialLogin"
            }
          },
          "required": [
            "credential"
          ],
          "type": "object"
        }
      ],
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "type": "object",
      "unevaluatedProperties": false
    },
    "MediaType": {
      "description": "用于指定规则适用的媒体内容类型。",
      "oneOf": [
        {
          "const": "video",
          "description": "视频类型，如电影、电视剧等。",
          "type": "string"
        },
        {
          "const": "audio",
          "description": "音频类型，如音乐、播客等。",
          "type": "string"
        },
        {
          "const": "book",
          "description": "书籍类型，如电子书、小说等。",
          "type": "string"
        },
        {
          "const": "manga",
          "description": "漫画类型，如漫画、图画书等。",
          "type": "string"
        }
      ]
    },
    "Meta": {
      "additionalProperties": false,
      "description": "元数据 (Meta)\n描述规则的基本信息。",
      "properties": {
        "author": {
          "description": "规则作者。",
          "type": "string"
        },
        "description": {
          "description": "规则的详细描述。",
          "type": [
            "string",
            "null"
          ]
        },
        "domain": {
          "description": "目标网站的主域名。",
          "type": "string"
        },
        "encoding": {
          "description": "目标网站的编码，默认为 \"UTF-8\"。",
          "type": [
            "string",
            "null"
          ]
        },
        "icon_url": {
          "description": "数据源的图标URL，用于UI展示。",
          "type": [
            "string",
            "null"
          ]
        },
        "media_type": {
          "$ref": "#/$defs/MediaType",
          "description": "规则主要适用的媒体类型。"
        },
        "name": {
          "description": "规则名称，如“示例影视站”。",
          "type": "string"
        },
        "spec_version": {
          "description": "本规则遵循的规范版本号。",
          "type": "string"
        },
        "version": {
          "description": "规则版本号，建议遵循 SemVer (如 \"1.0.2\")。",
          "type": "string"
        }
      },
      "required": [
        "name",
        "author",
        "version",
        "spec_version",
        "domain",
        "media_type"
      ],
      "type": "object"
    },
    "PaginationConfig": {
      "additionalProperties": false,
      "description": "分页配置",
      "properties": {
        "max_pages": {
          "description": "最大页数限制",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "page_param": {
          "default": "page",
          "description": "页码参数名",
          "type": "string"
        },
        "page_size": {
          "description": "每页数量（如果适用）",
          "format": "uint32",
          "minimum": 0,
          "type": [
            "integer",
            "null"
          ]
        },
        "pagination_type": {
          "$ref": "#/$defs/PaginationType",
          "default": "page_number",
          "description": "分页类型"
        },
        "start_page": {
          "default": 1,
          "description": "起始页码",
          "format": "uint32",
          "minimum": 0,
          "type": "integer"
        }
      },
      "type": "object"
    },
    "PaginationType": {
      "description": "分页类型",
      "oneOf": [
        {
          "const": "page_number",
          "description": "页码分页",
          "type": "string"
        },
        {
          "const": "offset",
          "description": "偏移量分页",
          "type": "string"
        },
        {
          "const": "cursor",
          "description": "游标分页",
          "type": "string"
        }
      ]
    },
    "PlayLineListRule": {
      "additionalProperties": false,
      "description": "播放线路列表提取规则 (PlayLineListRule)\n定义如何提取播放线路和剧集",
      "properties": {
        "episodes": {
          "$ref": "#/$defs/EpisodeListRule",
          "description": "剧集列表的提取规则（相对于单个线路元素）"
        },
        "line_name": {
          "$ref": "#/$defs/FieldRule",
          "description": "线路名称的提取规则（相对于单个线路元素）"
        },
        "lines": {
          "$ref": "#/$defs/FieldRule",
          "description": "线路列表容器的提取流程"
        }
      },
      "required": [
        "lines",
        "line_name",
        "episodes"
      ],
      "type": "object"
    },
    "RegexStep": {
      "anyOf": [
        {
          "description": "简单正则（默认取第1组）",
          "type": "string"
        },
        {
          "description": "带配置的正则",
          "properties": {
            "global": {
              "default": false,
              "description": "是否全局匹配",
              "type": "boolean"
            },
            "group": {
              "default": 1,
              "description": "捕获组索引（默认 1）",
              "format": "uint",
              "minimum": 0,
              "type": "integer"
            },
            "pattern": {
              "description": "正则表达式模式",
              "type": "string"
            }
          },
          "required": [
            "pattern"
          ],
          "type": "object"
        }
      ],
      "description": "正则表达式步骤"
    },
    "ScriptEngine": {
      "description": "脚本引擎类型 (ScriptEngine)\n用于指定脚本执行环境的类型。",
      "oneOf": [
        {
          "const": "rhai",
          "description": "Rhai 脚本引擎（默认）。",
          "type": "string"
        },
        {
          "const": "javascript",
          "description": "JavaScript 脚本引擎。",
          "type": "string"
        },
        {
          "const": "python",
          "description": "Python 脚本引擎。",
          "type": "string"
        },
        {
          "const": "lua",
          "description": "Lua 脚本引擎。",
          "type": "string"
        }
      ]
    },
    "ScriptModule": {
      "description": "脚本模块 (ScriptModule)\n定义一个脚本文件的来源。",
      "oneOf": [
        {
          "description": "直接内联在规则中的代码。",
          "properties": {
            "code": {
              "type": "string"
            }
          },
          "required": [
            "code"
          ],
          "type": "object"
        },
        {
          "description": "相对于规则文件的脚本路径。",
          "properties": {
            "file": {
              "type": "string"
            }
          },
          "required": [
            "file"
          ],
          "type": "object"
        },
        {
          "description": "远程URL加载的脚本。",
          "properties": {
            "url": {
              "type": "string"
            }
          },
          "required": [
            "url"
          ],
          "type": "object"
        }
      ],
      "properties": {
        "engine": {
          "anyOf": [
            {
              "$ref": "#/$defs/ScriptEngine"
            },
            {
              "type": "null"
            }
          ],
          "description": "脚本引擎，如果指定，则覆盖全局配置。"
        }
      },
      "type": "object"
    },
    "ScriptStep": {
      "anyOf": [
        {
          "description": "简单脚本名",
          "type": "string"
        },
        {
          "description": "带参数的脚本调用",
          "properties": {
            "name": {
              "description": "脚本名称（`模块.函数` 或 `函数`）",
              "type": "string"
            },
            "params": {
              "additionalProperties": true,
              "description": "脚本参数",
              "type": [
                "object",
                "null"
              ]
            }
          },
          "required": [
            "name"
          ],
          "type": "object"
        }
      ],
      "description": "脚本调用步骤"
    },
    "ScriptingConfig": {
      "additionalProperties": false,
      "description": "脚本配置 (ScriptingConfig)\n配置用于执行自定义逻辑的脚本环境。",
      "properties": {
        "engine": {
          "$ref": "#/$defs/ScriptEngine",
          "description": "默认脚本引擎。"
        },
        "modules": {
          "additionalProperties": {
            "$ref": "#/$defs/ScriptModule"
          },
          "description": "定义脚本模块，key 为模块名，用于在 `script` 步骤中调用。",
          "type": "object"
        }
      },
      "required": [
        "engine",
        "modules"
      ],
      "type": "object"
    },
    "SearchFlow": {
      "additionalProperties": false,
      "description": "搜索流程 (SearchFlow)\n实现搜索功能\n\n# 示例\n\n```toml\n[search]\nurl = \"https://example.com/search?q={{ keyword }}&page={{ page }}\"\n\n[search.pagination]\npagination_type = \"page_number\"\n\n[search.fields]\ntitle.steps = [{ css = \".title\" }]\nurl.steps = [{ css = \"a\" }, { attr = \"href\" }]\n```",
      "properties": {
        "description": {
          "description": "流程的功能描述",
          "type": [
            "string",
            "null"
          ]
        },
        "fields": {
          "$ref": "#/$defs/ItemFields",
          "description": "列表项字段定义"
        },
        "pagination": {
          "anyOf": [
            {
              "$ref": "#/$defs/PaginationConfig"
            },
            {
              "type": "null"
            }
          ],
          "description": "分页配置（可选）"
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "搜索 URL 模板\n约定输入变量: {{ keyword }}, {{ page }}"
        }
      },
      "required": [
        "url",
        "fields"
      ],
      "type": "object"
    },
    "SelectorStep": {
      "anyOf": [
        {
          "description": "简单选择器字符串",
          "type": "string"
        },
        {
          "description": "带配置的选择器",
          "properties": {
            "all": {
              "default": false,
              "description": "是否选择所有匹配（默认 false）",
              "type": "boolean"
            },
            "selector": {
              "description": "选择器表达式",
              "type": "string"
            }
          },
          "required": [
            "selector"
          ],
          "type": "object"
        }
      ],
      "description": "选择器步骤（CSS/JSONPath/XPath 通用）"
    },
    "SuccessCheck": {
      "description": "登录成功检测",
      "oneOf": [
        {
          "description": "JSONPath 检测",
          "properties": {
            "expect": {
              "description": "期望值"
            },
            "path": {
              "description": "JSONPath 表达式",
              "type": "string"
            },
            "type": {
              "const": "json_path",
              "type": "string"
            }
          },
          "required": [
            "type",
            "path",
            "expect"
          ],
          "type": "object"
        },
        {
          "description": "状态码检测",
          "properties": {
            "expect": {
              "description": "期望的状态码",
              "format": "uint16",
              "maximum": 65535,
              "minimum": 0,
              "type": "integer"
            },
            "type": {
              "const": "status_code",
              "type": "string"
            }
          },
          "required": [
            "type",
            "expect"
          ],
          "type": "object"
        },
        {
          "description": "响应包含检测",
          "properties": {
            "text": {
              "description": "期望包含的字符串",
              "type": "string"
            },
            "type": {
              "const": "contains",
              "type": "string"
            }
          },
          "required": [
            "type",
            "text"
          ],
          "type": "object"
        }
      ]
    },
    "Template": {
      "description": "模板字符串 (Template)\n\n支持 Tera 模板语法的字符串类型，用于在运行时进行变量插值。\n\n## 语法规范\n- 变量插值: `{{ variable }}`\n- 嵌套访问: `{{ user.name }}`, `{{ items[0] }}`\n- 过滤器: `{{ name | upper }}`\n- 条件: `{% if condition %}...{% endif %}`\n- 循环: `{% for item in items %}...{% endfor %}`\n\n## 示例\n```text\nhttps://example.com/search?q={{ keyword }}\nHello, {{ user.name }}!\n{{ items[0].title }}\n```",
      "pattern": "{{\\s*([a-zA-Z_][a-zA-Z0-9_]*(?:\\.[a-zA-Z_][a-zA-Z0-9_]*|\\[[0-9]+\\])*)\\s*}}",
      "type": "string"
    },
    "TrackListRule": {
      "additionalProperties": false,
      "description": "音轨列表提取规则 (TrackListRule)",
      "properties": {
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/FieldRule"
            },
            {
              "type": "null"
            }
          ],
          "description": "时长的提取规则（可选）"
        },
        "list": {
          "$ref": "#/$defs/FieldRule",
          "description": "音轨列表的提取流程"
        },
        "name": {
          "$ref": "#/$defs/FieldRule",
          "description": "音轨名称的提取规则"
        },
        "url": {
          "$ref": "#/$defs/FieldRule",
          "description": "音轨 URL 的提取规则"
        }
      },
      "required": [
        "list",
        "name",
        "url"
      ],
      "type": "object"
    },
    "WebViewLogin": {
      "additionalProperties": false,
      "description": "WebView 登录配置",
      "properties": {
        "cookie_domain": {
          "description": "Cookie 域名（可选，默认为 URL 的根域名）",
          "type": [
            "string",
            "null"
          ]
        },
        "success_selector": {
          "description": "登录成功检测选择器（可选）\n如果提供，检测该元素存在则认为登录成功",
          "type": [
            "string",
            "null"
          ]
        },
        "url": {
          "$ref": "#/$defs/Template",
          "description": "登录页 URL"
        }
      },
      "required": [
        "url"
      ],
      "type": "object"
    }
  },
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "description": "影视软件爬虫规则 (CrawlerRule)",
  "properties": {
    "content": {
      "anyOf": [
        {
          "$ref": "#/$defs/ContentFlow"
        },
        {
          "type": "null"
        }
      ],
      "description": "内容页流程（可选）\n用于播放页、阅读页等需要进一步解析内容的场景"
    },
    "detail": {
      "$ref": "#/$defs/DetailFlow",
      "description": "详情页流程（必需）"
    },
    "discovery": {
      "anyOf": [
        {
          "$ref": "#/$defs/DiscoveryFlow"
        },
        {
          "type": "null"
        }
      ],
      "description": "发现页流程（可选）\n提供筛选器和分页配置"
    },
    "http": {
      "anyOf": [
        {
          "$ref": "#/$defs/HttpConfig"
        },
        {
          "type": "null"
        }
      ],
      "description": "全局的网络请求配置，可被流程局部配置覆盖。"
    },
    "login": {
      "anyOf": [
        {
          "$ref": "#/$defs/LoginFlow"
        },
        {
          "type": "null"
        }
      ],
      "description": "登录流程（可选）"
    },
    "meta": {
      "$ref": "#/$defs/Meta",
      "description": "规则的元数据，用于在软件中识别和展示。"
    },
    "scripting": {
      "anyOf": [
        {
          "$ref": "#/$defs/ScriptingConfig"
        },
        {
          "type": "null"
        }
      ],
      "description": "脚本引擎的全局配置。"
    },
    "search": {
      "$ref": "#/$defs/SearchFlow",
      "description": "搜索流程（必需）"
    }
  },
  "required": [
    "meta",
    "detail",
    "search"
  ],
  "title": "CrawlerRule",
  "type": "object"
}
